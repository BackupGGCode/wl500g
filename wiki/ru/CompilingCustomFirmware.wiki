#summary Самостоятельная сборка прошивки

== 1. Необходимый софт ==

  * Linux с установленными пакетами
    * standard compilation software
    * libncurses-dev
    * gawk
    * g++
    * flex
    * bison
    * zlib development
    * subversion

== 2. Скачать дополнительные инструменты и исходники ==
  * Toolchain [http://code.google.com/p/wl500g/downloads/list?can=2&q=hndtools-mipsel-uclibc hndtools-mipsel-uclibc-4.2.4]
  * ядро Linux 
    * Для основной ветки 1.9.2.7-d вам нужно ядро [http://www.kernel.org/pub/linux/kernel/v2.4/linux-2.4.37.9.tar.bz2 linux-2.4.37.9.tar.bz2]
    * Для экспериментальной 1.9.2.7-rtn вам нужно ядро [http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.22.19.tar.bz2 linux-2.6.22.19.tar.bz2]

== 3. Распаковать архивы и подготовить дерево сборки ==

  # Распаковка (путь _/whatever-you-want_ заменить на тот, где будет храниться дерево сборки) 
    установите переменную KVER в версию ядра из пункта 2
{{{
KVER=2.4.37.9
mkdir -p /whatever-you-want/broadcom/src/linux
mkdir -p /opt/brcm
tar -C /opt/brcm -jxvf hndtools-mipsel-uclibc-4.2.4.tar.bz2
ln -sf /opt/brcm/hndtools-mipsel-uclibc-4.2.4 /opt/brcm/hndtools-mipsel-uclibc
tar -C /whatever-you-want/broadcom/src/linux -jxvf linux-$KVER.tar.bz2
if [ "${KVER#2.6}" != "${KVER}" ]; then
  ln -sf linux-$KVER /whatever-you-want/broadcom/src/linux/linux-2.6
else
  ln -sf linux-$KVER /whatever-you-want/broadcom/src/linux/linux
fi
}}}
  # Получение исходников прошивки
    * 1.9.2.7-d
{{{
svn checkout http://wl500g.googlecode.com/svn/trunk/ /whatever-you-want/broadcom/src/1.9.2.7-d
}}}
    * 1.9.2.7-rtn
{{{
svn checkout http://wl500g.googlecode.com/svn/branches/rt-n/ /whatever-you-want/broadcom/src/1.9.2.7-rtn
}}}
  # Добавить путь к Toolchain (можно внести в личный .profile для удобства)
{{{
$ export PATH=$PATH:/opt/brcm/hndtools-mipsel-uclibc/bin
}}}

== 4. Сборка и компиляция ==

  # Сборка
{{{
$ cd /whatever-you-want/broadcom/src/1.9.2.7-d
$ make kernel
$ make
}}}
  # Изменить MODEL=wl500gp в /whatever-you-want/broadcom/src/gateway/Makefile на желаемую
  # Компиляция
{{{
$ cd /whatever-you-want/broadcom/src/gateway
$ make
$ make install
}}}

== 5. Обновление из SVN ==
   * Если вы обновили дерево исходников из SVN, и хотите пересобрать только измененную часть, то алгоритм усложняется:
     * Если обновились патчи к ядру, то необходимо
       * переразвернуть оригинальное ядро из архива (см. пункт 3.1)
       * перенакат патчей и обновление конфига
{{{
$ cd /whatever-you-want/broadcom/src/1.9.2.7-d
$ make kernel
$ cd /whatever-you-want/broadcom/src/gateway
$ make koldconf
}}}
     * Если обновились только пакеты, то достаточно следующего
{{{
$ cd /whatever-you-want/broadcom/src/1.9.2.7-d
$ rm -rf /whatever-you-want/broadcom/src/gateway
$ make
}}}
   * Далее перейти на пункт 4.2 данного !HowTo.
   * Более прицельное обновление также возможно, но требует знания работы patch, make и других средств разработки, а обучение работы с ними выходит за рамки этого !HowTo.
